<!--
Copyright 2014 The Toolkitchen Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->

<link rel="import" href="../polymer-selector/polymer-selector.html">
<link rel="import" href="../paper-ink/paper-ink.html">
<link rel="import" href="paper-calculator-keygrid.html">
<link rel="import" href="paper-calculator-panels.html">

<polymer-element name="paper-calculator-keypad" attributes="wideMode standardKeys advancedKeys modeKeys level">

  <template>

    <style>
    
      :host {
        display: block;
        position: relative;
        cursor: pointer;
        overflow: hidden;
      }
      
      paper-calculator-panels {
        width: 100%;
        height: 100%;
        background-color: #1de9b6;
        cursor: pointer;
      }
      
      .standard {
        background-color: #4c4c4c;
        font-weight: 300;
        font-size: 2em;
        color: #fff;
      }
      
      .standard ^ .column:nth-of-type(4) {
        background-color: #666;
        border-left: 1px solid #444;
      }
      
      .advanced {
        background-color: #40bd9e;
        font-weight: 400;
        font-size: 1.125em;
        color: #f7f7f7;
      }
      
      .mode {
        background-color: #1de9b6;
        font-weight: 400;
        font-size: 1em;
        color: #777;
      }
      
      .step {
        box-shadow: -3px 0 3px -3px rgba(0, 0, 0, 0.25);
      }
      
      .step.dragging, paper-calculator-panels.narrow-layout .step.opened {
        box-shadow: -10px 0 6px -6px rgba(0, 0, 0, 0.25);
      }
      
      .step.dragging {
        transition: none;
      }
      
      paper-ink {
        position: fixed;
        width: 60px;
        height: 60px;
        pointer-events: none;
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }
      
      paper-ink ^ #inkOuter {
        box-shadow: 2px 2px 3px 0px rgba(0, 0, 0, 0.2);
      }
      
      paper-ink ^ #inkInner {
        background-color: #4c4c4c;
      }
      
      paper-ink.keys1 ^ #inkInner {
        background-color: #40bd9e;
      }
      
      paper-ink.keys2 ^ #inkInner {
        background-color: #1de9b6;
      }
      
    </style>
    
    <paper-calculator-panels class="{{wideMode ? 'wide-layout' : 'narrow-layout'}}" selected="{{level}}" wideMode="{{wideMode}}" on-trackstart="{{resetInk}}" on-cal-keydown="{{inkSpill}}" on-pointerup="{{inkEvaporate}}" on-pointerleave="{{inkEvaporate}}">
    
      <paper-calculator-keygrid id="standard" class="standard" flex="1" keys="{{standardKeys}}"></paper-calculator-keygrid>
    
      <paper-calculator-keygrid class="advanced step" flex="0.75" keys="{{advancedKeys}}"></paper-calculator-keygrid>
      
      <paper-calculator-keygrid class="mode step" flex="0.182" keys="{{modeKeys}}"></paper-calculator-keygrid>
      
    </paper-calculator-panels>
    
    <paper-ink id="ink" color="rgba(241, 250, 65, 0.85)" duration="240" class="keys{{activatedKeys}}" on-paper-ink-evaporate-complete="{{resetInk}}"></paper-ink>
      
    
  </template>

  <script>

    Polymer('paper-calculator-keypad', {
      
      resetInk: function() {
        this.$.ink.reset();
        if (this.keyNode) {
          this.keyNode.classList.remove('active');
        }
      },
      
      inkSpill: function(e) {
        this.activatedKeys = [this.standardKeys, this.advancedKeys, 
            this.modeKeys].indexOf(e.target.keys);
        this.resetInk();
        this.keyNode = e.detail.keyNode;
        this.keyNode.classList.add('active');
        var rect = this.keyNode.getBoundingClientRect();
        var x = rect.left + rect.width / 2;
        var y = rect.top + rect.height / 2;
        var w = this.$.ink.offsetWidth / 2;
        this.$.ink.style.top = y - w + 'px';
        this.$.ink.style.left = x - w + 'px';
        this.$.ink.spill();
      },
      
      inkEvaporate: function() {
        this.$.ink.evaporateAfterSpillCompleted();
      },
      
      get equalKeyNode() {
        return this.$.standard.findKeyNode('=');
      }
      
    });

  </script>

</polymer-element>